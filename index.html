<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>禁漫天堂聚合站 - joe666.dpdns.org</title>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:"Microsoft YaHei",Arial;background:linear-gradient(135deg,#1a0933,#2d1b4e);color:#fff;min-height:100vh}
        .header{background:rgba(20,0,40,0.85);backdrop-filter:blur(15px);position:fixed;top:0;width:100%;z-index:999;padding:15px 20px;box-shadow:0 5px 20px rgba(138,43,226,0.4)}
        .logo{font-size:2.2em;font-weight:bold;background:linear-gradient(90deg,#ff00cc,#833ab4,#00ffcc);background-clip:text;-webkit-background-clip:text;color:transparent}
        .search-bar{max-width:900px;margin:80px auto 20px;padding:0 20px}
        .search-box{display:flex;gap:10px;margin-bottom:20px}
        #kw{flex:1;padding:18px 25px;border:none;border-radius:50px;background:rgba(255,255,255,0.15);color:#fff;font-size:1.2em;outline:none;border:2px solid transparent;transition:0.3s}
        #kw:focus{border:2px solid #ff00cc}
        button{padding:18px 40px;border:none;border-radius:50px;background:linear-gradient(45deg,#ff00cc,#9c27b0);color:#fff;font-size:1.2em;cursor:pointer;box-shadow:0 8px 25px rgba(156,39,176,0.5);transition:0.3s}
        button:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(156,39,176,0.7)}
        .controls{text-align:center;margin:20px 0}
        .controls button{margin:0 10px;padding:12px 30px;border-radius:30px;background:rgba(255,255,255,0.1);border:1px solid #ff00cc}
        .container{max-width:1400px;margin:0 auto;padding:0 15px}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;margin-top:20px}
        .item{position:relative;border-radius:15px;overflow:hidden;background:rgba(0,0,0,0.3);box-shadow:0 8px 25px rgba(0,0,0,0.6);transition:0.3s;cursor:pointer}
        .item:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(255,0,204,0.4)}
        .item img{width:100%;height:260px;object-fit:cover;transition:0.5s}
        .item:hover img{transform:scale(1.15)}
        .title{position:absolute;bottom:0;left:0;right:0;padding:15px;background:linear-gradient(transparent,#000);font-size:0.95em;line-height:1.4}
        .dl{position:absolute;top:10px;right:10px;background:#ff00cc;padding:8px 12px;border-radius:50%;opacity:0;transition:0.3s;font-weight:bold}
        .item:hover .dl{opacity:1}
        .loading{text-align:center;padding:60px 0;font-size:1.5em}
        .spinner{width:60px;height:60px;border:6px solid rgba(255,0,204,0.3);border-top:6px solid #ff00cc;border-radius:50%;animation:s 1s linear infinite;margin:20px auto}
        @keyframes s{to{transform:rotate(360deg)}}
        footer{text-align:center;padding:50px 20px;opacity:0.7;font-size:0.9em}
    </style>
</head>
<body>

<div class="header">
    <div class="logo">H漫天堂聚合站</div>
</div>

<div class="search-bar">
    <div class="search-box">
        <input type="text" id="kw" placeholder="输入本子名称、作者、标签或番号（如 500500 / full color / 巨乳）" autofocus>
        <button onclick="search()">搜 索</button>
    </div>
    <div class="controls">
        <button onclick="downloadAll()">打包下载整部 (ZIP)</button>
        <button onclick="clearGallery()">清空画廊</button>
    </div>
</div>

<div class="container">
    <div id="loading" class="loading" style="display:none">
        <div class="spinner"></div>
        <p>正在从禁漫天堂、HentaiFox、Nhentai、E-Hentai、Hitomi 五大站点疯狂抓取中…</p>
    </div>
    <div id="grid" class="grid"></div>
</div>

<footer>© 2025 joe666.dpdns.org • 全球最强禁漫天堂聚合站 • 仅限18岁以上使用</footer>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
    particlesJS("body",{particles:{number:{value:60},color:{value:"#ff00cc"},size:{value:3},opacity:{value:0.4,random:true},line_linked:{enable:true,distance:180,color:"#ff00cc",opacity:0.2,width:1},move:{enable:true,speed:2}},interactivity:{events:{onhover:{enable:true,mode:"repulse"}}}});

    let allImages = [];

    async function search(){
        const kw = document.getElementById("kw").value.trim();
        if(!kw) return alert("请输入关键词");
        document.getElementById("loading").style.display = "block";
        document.getElementById("grid").innerHTML = "";
        allImages = [];

        const sites = [
            "https://jmcomic-zzz.one/search/photos?search_query="+kw,
            "https://hentaifox.com/search/?q="+kw,
            "https://nhentai.net/search/?q="+kw,
            "https://e-hentai.org/?f_search="+kw,
            "https://hitomi.la/search.html? "+kw
        ];

        await Promise.all(sites.map(url => fetchImages(url)));
        document.getElementById("loading").style.display = "none";
    }

    async function fetchImages(url){
        try{
            const res = await fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url));
            const html = await res.text();
            const doc = new DOMParser().parseFromString(html, "text/html");

            // 通用抓图逻辑（适配所有站点）
            const imgs = [...doc.querySelectorAll("img")].map(img => {
                let src = img.src || img.dataset.src || img.dataset.original || img.getAttribute("data-lazy-src");
                if(!src) return null;
                if(src.includes("thumb") || src.includes("t.")) src = src.replace(/t\.|thumb|\.t\./g, ".");
                if(src.includes("//tn.")) src = src.replace("//tn.", "//a.");
                return src.includes("http") ? src : null;
            }).filter(Boolean);

            imgs.slice(0,50).forEach(src => {
                if(!allImages.includes(src)){
                    allImages.push(src);
                    const div = document.createElement("div");
                    div.className = "item";
                    div.innerHTML = `
                        <img src="${src}" loading="lazy">
                        <div class="dl" onclick="downloadSingle('${src}')">↓</div>
                        <div class="title">点击查看大图 · 右键或↓下载</div>
                    `;
                    div.onclick = () => window.open(src);
                    document.getElementById("grid").appendChild(div);
                }
            });
        }catch(e){}
    }

    function downloadSingle(url){
        fetch(url).then(r=>r.blob()).then(blob=>{
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = url.split("/").pop().split("?")[0] || "hentai.jpg";
            a.click();
        });
    }

    async function downloadAll(){
        if(allImages.length===0) return alert("画廊为空！");
        document.getElementById("loading").innerHTML = "<div class='spinner'></div><p>正在打包成ZIP，请耐心等待…</p>";
        document.getElementById("loading").style.display = "block";

        const zip = new JSZip();
        const folder = zip.folder("H漫合集_"+new Date().getTime());

        for(let i=0;i<allImages.length;i++){
            try{
                const res = await fetch(allImages[i]);
                const blob = await res.blob();
                folder.file(`image_${i+1}.jpg`, blob);
            }catch(e){}
        }

        zip.generateAsync({type:"blob"}).then(content=>{
            saveAs(content, "H漫合集_"+new Date().getTime()+".zip");
            document.getElementById("loading").style.display = "none";
        });
    }

    function clearGallery(){
        document.getElementById("grid").innerHTML = "";
        allImages = [];
    }

    // 回车搜索
    document.getElementById("kw").addEventListener("keypress", e=>{if(e.key==="Enter") search();});
</script>
</body>
</html>
