<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>免费无审核AI图片生成器（Perchance）</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        #container { max-width: 700px; margin: auto; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white; padding: 20px; }
        #history { min-height: 300px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px; }
        .generated-image { max-width: 500px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); align-self: center; }
        #input-row { display: flex; gap: 10px; }
        #prompt-input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        #num-images { padding: 12px; width: 80px; border: 1px solid #ddd; border-radius: 6px; }
        #gen-btn { padding: 12px 24px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        #gen-btn:hover { background: #1e88e5; }
        #gen-btn:disabled { background: #ccc; cursor: not-allowed; }
        .loading { color: #666; font-style: italic; align-self: center; }
        #note { max-width: 700px; margin: 20px auto; padding: 15px; background: #e8f5e8; border-radius: 8px; }
        h1 { text-align: center; }
    </style>
</head>
<body>
    <div id="note">
        <strong>使用说明：</strong><br>
        - 这是一个纯AI图片生成界面，使用 Perchance.org 的免费、无需注册、无限量、无任何内容审核的文本到图片生成器。<br>
        - 输入任何描述（支持中文、英文，越详细越好），点击生成即可。<br>
        - 一次可生成1-30张图片（默认6张），生成时间10-40秒（取决于服务器负载）。<br>
        - 完全免费、无限制、无水印、无审核，能生成任何内容。<br>
        - 直接保存这个HTML文件到电脑，离线打开也能用（只需联网生成图片）。
    </div>

    <div id="container">
        <h1>免费无审核AI图片生成器</h1>
        <div id="history"></div>
        <div id="input-row">
            <input type="text" id="prompt-input" placeholder="输入图片描述，例如：一只可爱的猫在太空飞翔，超现实主义风格，高清" autofocus>
            <input type="number" id="num-images" min="1" max="30" value="6" title="一次生成图片数量">
            <button id="gen-btn">生成图片</button>
        </div>
    </div>

    <script>
        const history = document.getElementById('history');
        const promptInput = document.getElementById('prompt-input');
        const numImagesInput = document.getElementById('num-images');
        const genBtn = document.getElementById('gen-btn');

        async function generateImages() {
            let prompt = promptInput.value.trim();
            if (!prompt) {
                alert('请输入图片描述！');
                return;
            }

            let num = parseInt(numImagesInput.value) || 6;
            if (num < 1 || num > 30) num = 6;

            // 添加提示和加载
            const promptDiv = document.createElement('div');
            promptDiv.textContent = `提示词：${prompt}（生成${num}张）`;
            promptDiv.style.fontWeight = 'bold';
            promptDiv.style.alignSelf = 'flex-start';
            history.appendChild(promptDiv);

            const loadingDiv = document.createElement('div');
            loadingDiv.textContent = '正在生成图片，请稍等10-40秒...（服务器负载高时可能更慢）';
            loadingDiv.classList.add('loading');
            history.appendChild(loadingDiv);

            genBtn.disabled = true;
            promptInput.disabled = true;

            try {
                // 使用 Perchance 专业图像生成器的反向工程API（社区常用，免费无限制）
                const response = await fetch('https://image-generation.perchance.org/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        numImages: num,  // 支持批量
                        advanced: {}     // 可扩展参数
                    })
                });

                if (!response.ok) throw new Error('服务器响应错误');

                const data = await response.json();

                // 移除加载提示
                history.removeChild(loadingDiv);

                if (data.images && data.images.length > 0) {
                    data.images.forEach(imgUrl => {
                        const img = document.createElement('img');
                        img.src = imgUrl;
                        img.classList.add('generated-image');
                        img.onclick = () => window.open(imgUrl, '_blank');  // 点击新标签大图
                        history.appendChild(img);
                    });
                } else {
                    throw new Error('未返回图片');
                }

                // 滚动到底部
                history.scrollTop = history.scrollHeight;

            } catch (error) {
                history.removeChild(loadingDiv);
                const errorDiv = document.createElement('div');
                errorDiv.textContent = '生成失败：' + error.message + '（可重试，或服务器暂时忙碌）';
                errorDiv.style.color = 'red';
                history.appendChild(errorDiv);
            } finally {
                genBtn.disabled = false;
                promptInput.disabled = false;
                promptInput.focus();
            }
        }

        genBtn.onclick = generateImages;
        promptInput.onkeypress = (e) => { if (e.key === 'Enter') generateImages(); };
    </script>
</body>
</html>
