<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>免费无审核AI聊天（直接调用网络API）</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        #chat-container { max-width: 700px; margin: auto; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white; }
        #chat-history { height: 500px; overflow-y: auto; padding: 15px; border-bottom: 1px solid #ddd; }
        .message { margin: 10px 0; padding: 10px; border-radius: 8px; max-width: 80%; }
        .user { background: #e1f5fe; align-self: flex-end; margin-left: auto; }
        .ai { background: #f1f1f1; align-self: flex-start; }
        #input-container { padding: 15px; display: flex; flex-direction: column; }
        #model-selector { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        #model-icon { width: 32px; height: 32px; border-radius: 50%; }
        #input-row { display: flex; gap: 10px; }
        #user-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        #send-btn { padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 6px; cursor: pointer; }
        #send-btn:hover { background: #45a049; }
        .uploaded-image { max-width: 300px; border-radius: 8px; margin-top: 8px; }
        #note { max-width: 700px; margin: 20px auto; padding: 15px; background: #e8f5e8; border-radius: 8px; }
    </style>
</head>
<body>
    <div id="note">
        <strong>使用说明：</strong><br>
        1. 去 <a href="https://console.groq.com/keys" target="_blank">Groq官网</a> 免费注册并创建一个API Key（完全免费，额度很高）<br>
        2. 把你的API Key粘贴到下面输入框<br>
        3. 选择模型即可开始聊天（推荐 llama-3.1-70b-versatile，几乎无内容限制）
    </div>

    <div id="chat-container">
        <div id="chat-history"></div>
        <div id="input-container">
            <div id="model-selector">
                <label>API Key:</label>
                <input type="password" id="api-key" placeholder="粘贴你的Groq API Key" style="flex:1; padding:8px;">
                <select id="model-select">
                    <option value="llama-3.1-70b-versatile">Llama 3.1 70B (推荐)</option>
                    <option value="llama-3.1-8b-instant">Llama 3.1 8B (更快)</option>
                    <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                    <option value="gemma2-9b-it">Gemma 2 9B</option>
                </select>
                <img id="model-icon" src="https://groq.com/wp-content/uploads/2024/05/Groq_Logo.png" alt="Groq">
            </div>
            <div id="input-row">
                <input type="text" id="user-input" placeholder="输入消息...（支持上传图片）">
                <input type="file" id="file-input" accept="image/*">
                <button id="send-btn">发送</button>
            </div>
        </div>
    </div>

    <script>
        const chatHistory = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');
        const fileInput = document.getElementById('file-input');
        const sendBtn = document.getElementById('send-btn');
        const modelSelect = document.getElementById('model-select');
        const apiKeyInput = document.getElementById('api-key');

        let messages = [];

        async function sendMessage() {
            const prompt = userInput.value.trim();
            const apiKey = apiKeyInput.value.trim();
            const file = fileInput.files[0];

            if (!apiKey) {
                alert("请先输入你的Groq API Key！");
                return;
            }
            if (!prompt && !file) return;

            // 显示用户消息
            addMessage('user', prompt || '[上传了图片]');
            if (file && file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.classList.add('uploaded-image');
                chatHistory.lastChild.appendChild(img);
            }

            userInput.value = '';
            fileInput.value = '';

            // 准备消息（目前Groq不支持直接上传图片，这里仅文本）
            // 如果想支持图片，建议换Together.ai或DeepInfra的多模态模型
            messages.push({ role: 'user', content: prompt || '请描述这张图片' });

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modelSelect.value,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 4096
                    })
                });

                const data = await response.json();
                if (data.error) {
                    addMessage('ai', '错误：' + data.error.message);
                    return;
                }

                const aiResponse = data.choices[0].message.content;
                addMessage('ai', aiResponse);
                messages.push({ role: 'assistant', content: aiResponse });
            } catch (error) {
                addMessage('ai', '网络错误：' + error.message);
            }
        }

        function addMessage(sender, text) {
            const div = document.createElement('div');
            div.classList.add('message', sender);
            div.textContent = text;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        sendBtn.onclick = sendMessage;
        userInput.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };
    </script>
</body>
</html>
